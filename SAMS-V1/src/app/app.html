<div class="min-vh-100 bg-light p-4 p-sm-5">
  <app-header [errorMessage]="errorMessage" [successMessage]="successMessage"></app-header>

  <app-navigation
    [currentView]="currentView"
    [isLoading]="isLoading"
    [views]="views"
    (viewChange)="setView($event)"
  ></app-navigation>

  <main class="container-xxl mx-auto bg-white p-5 rounded-4 shadow-lg">
    @if (isLoading()) {
      <div class="d-flex align-items-center justify-content-center p-5 fs-5 text-primary">
        <div class="spinner-border me-3" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        Loading real-time data from server...
      </div>
    }

    @if (currentView() === 'dashboard' && !isLoading()) {
      <app-dashboard-metrics
        [totalStudents]="students().length"
        [activeBatchesCount]="activeBatchesCount()"
        [checkedInCount]="checkedInCount()"
        [attendanceRatio]="attendanceRatio()"
      ></app-dashboard-metrics>
    }

    @if (currentView() === 'attendance' && !isLoading()) {
      <app-attendance
        [isProcessing]="isProcessing"
        [actionType]="actionType"
        (checkIn)="handleCheckIn($event)"
        (checkOut)="handleCheckOut($event)"
      ></app-attendance>
    }

    @if (currentView() === 'batches' && !isLoading()) {
      <app-batches
        [batches]="batches"
        [isCreatingBatch]="isCreatingBatch"
        [isProcessing]="isProcessing"
        (createBatch)="handleCreateBatch($event)"
        (toggleCreateBatch)="toggleCreateBatchForm()"
      ></app-batches>
    }

    @if (currentView() === 'students' && !isLoading()) {
      <app-students [students]="students"></app-students>
    }

    @if (currentView() === 'create-student' && !isLoading()) {
      <app-create-student
        [isProcessing]="isProcessing"
        [batches]="batches"
        (createStudent)="handleCreateStudent($event)"
      ></app-create-student>
    }
  </main>
</div>
